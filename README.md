This repository if for deepControl.

The Deep Neural Network (DNN) Controller is a two hidden layer Neural Network with 64 neurons in each layer.

The quadrotor state-space equation is a 12 dimensional vector

```
s  = [x,y,z, vx,vy,vz, roll,pitch,yaw, rs,ps,ys]
```
where 

1. x,y,z is the position
2. vx, vy, vz is the linear velocities
3. roll,pitch,yaw are the Euler Angles
4. rs,ps,ys are the angular velocities

This high level controller on the quadrotor takes in the state and outputs the controls:

```
u = [roll_commanded, pitch_commanded, yaw_rate, thrust_commanded]
```

The dynamics of the quadrotor dictate that the yaw motion is decoupled from the roll and pitch motion. Therefore  we keep the yaw as constant. The DNN takes in the state and outputs the three controls: *[roll_commanded, pitch_commanded, thrust_commanded]*


The DNN weights are learned by using supervised learning. The data for learning is generated by using Model Predictive Controller running on the quadrotor.

The learned controller can be implemented in either C++ or python.

## Structure of DNN

The DNN has 2 hidden layers each with 64 neurons.


`Input `

 The desired position is denoted by `[x_des, y_des, z_des]`. The input to the DNN is given as

```
X = [x_des-x, y_des-y, z_des-z, vx, vy, vz, roll, pitch, rs, ps]
```

This input is fed to the first layer:

```
o1 = relu(W1.X + B1)
```
where relu is the activation function, W1 is the weight matrix and B1 is the bias, of layer 1.

Similarly for the 2nd layer.

```
o2 = relu(W2.o1 + B2)
```

`Output`

The output from the DNN controller is `[roll, pitch, thrust]`

For the output layer the activation function used is tanh as it bounds the output between [-1, 1].

```
y = tanh(W3.o2 + B3)
```


The thrust is output is scaled up according to the weight of the quadrotor.


The  tracking performance of the DNN is at par with the MPC controller.

## Python

The `python/mav_deepControl.py` is the controller written in python with controller weight in `python/wt`


## C++

The C++ controller is located at `cpp/src/mav_deepControl.cpp` with weights in `cpp/include`. The C++ controller uses `Eigen` libraries for matrix arithmetic.


## Links

* [Video of Performance of DNN](https://drive.google.com/open?id=1Z_a_CmwhumUFh74s0MTm3x_xfKWtWsA_)


* [Non Linear Dynamics of the Quadrotor](https://scholarsarchive.byu.edu/cgi/viewcontent.cgi?article=2324&context=facpub)

* [Linearized Dynamics of the Quadrotor](https://www.kth.se/polopoly_fs/1.588039.1550155544!/Thesis%20KTH%20-%20Francesco%20Sabatino.pdf)

Values of the plant for F450
* inertia : [ 0.0337 , 0.000000 , 0.000000 , 0.000000 , 0.0337 , 0.000000 , 0.000000 , 0.000000 , 0.0185]
* rotors: 4

* rotor_force_constant: 8.54858e-6
* rotor_moment_constant: 0.016000
* arm_length: 0.225
